import requests
from riddle_solvers import riddle_solvers
from PIL import Image
import torchvision.transforms as transforms
import numpy as np
from LSBSteg import encode, decode
import matplotlib.pyplot as plt
import cv2

api_base_url = "http://localhost:5000"
teamId = "team1234"


def test():
    # data = {"teamId": teamId}

    ps_e_solver = riddle_solvers["problem_solving_easy"]
    ps_m_solver = riddle_solvers["problem_solving_medium"]
    ps_h_solver = riddle_solvers["problem_solving_hard"]
    sec_m_solver = riddle_solvers["sec_medium_stegano"]
    sec_h_solver = riddle_solvers["sec_hard"]

    # Easy PS

    # res = requests.post(url=f"{api_base_url}/get-riddle/ps-easy")
    # res = res.json()

    # output = ps_e_solver(res)

    # print(output)

    # res = requests.post(
    #     url=f"{api_base_url}/solve-riddle/ps-easy",
    #     json={"solution": output},
    # )
    # print(res.text)

    # Medium PS

    # output = ps_m_solver("3[d1[e2[l]]]")

    # print(output)

    # res = requests.post(
    #     url=f"{api_base_url}/solve-riddle/ps-medium",
    #     json={"solution": output},
    # )
    # print(res.text)

    # # Hard PS

    # res = requests.post(url=f"{api_base_url}/get-riddle/ps-hard")
    # res = res.json()

    # output = ps_h_solver(res)

    # print(output)

    # res = requests.post(
    #     url=f"{api_base_url}/solve-riddle/ps-hard",
    #     json={"solution": output},
    # )
    # print(res.text)

    # Security hard
    res = requests.post(url=f"{api_base_url}/get-riddle/sec-hard")
    res = res.json()

    print(res)

    output = sec_h_solver(res["test_case"])

    print(output)

    res = requests.post(
        url=f"{api_base_url}/solve-riddle/sec-hard",
        json={"solution": output},
    )
    print(res.text)

    # # Security Medium
    # img_path = "Solvers\sample_example\encoded.png"
    # img = Image.open(img_path)

    # preprocess = transforms.Compose([transforms.ToTensor()])
    # img_tensor = preprocess(img)
    # img = img_tensor.tolist()

    # print(type(img))

    # output = sec_m_solver(img)

    # print(output)


test()

# l = [1, 2, 3, 4]
# l = np.array(l)

# print(type(l))

# message = "Secret messages rock"

# message1 = message[0:7]
# message2 = message[7:14]
# message3 = message[14:]

# print(f"'{message1}'")
# print(f"'{message2}'")
# print(f"'{message3}'")

# inp = [
#     [
#         [13, 11, 33],
#         [14, 15, 36],
#         [12, 13, 33],
#         [12, 17, 36],
#         [20, 26, 48],
#         [22, 32, 57],
#         [27, 36, 67],
#         [34, 44, 80],
#         [51, 62, 107],
#         [48, 59, 104],
#         [55, 62, 108],
#         [42, 47, 85],
#         [35, 40, 70],
#         [37, 42, 61],
#         [23, 25, 37],
#         [17, 21, 30],
#         [20, 23, 40],
#         [19, 24, 44],
#         [19, 24, 44],
#         [20, 25, 45],
#     ],
#     [
#         [11, 9, 30],
#         [13, 14, 34],
#         [13, 14, 34],
#         [11, 16, 35],
#         [17, 24, 43],
#         [19, 30, 52],
#         [28, 37, 68],
#         [40, 50, 86],
#         [44, 56, 98],
#         [42, 53, 98],
#         [51, 60, 103],
#         [40, 48, 85],
#         [29, 34, 63],
#         [23, 28, 48],
#         [17, 21, 32],
#         [26, 30, 39],
#         [18, 24, 40],
#         [18, 23, 43],
#         [19, 24, 44],
#         [20, 25, 45],
#     ],
#     [
#         [10, 9, 27],
#         [13, 14, 32],
#         [14, 15, 33],
#         [11, 17, 33],
#         [16, 23, 41],
#         [18, 29, 49],
#         [30, 39, 68],
#         [46, 56, 92],
#         [57, 69, 111],
#         [49, 60, 105],
#         [51, 60, 103],
#         [40, 48, 85],
#         [26, 33, 61],
#         [16, 23, 42],
#         [11, 20, 29],
#         [25, 32, 40],
#         [19, 25, 41],
#         [19, 24, 43],
#         [20, 25, 44],
#         [21, 26, 45],
#     ],
#     [
#         [14, 13, 29],
#         [16, 15, 31],
#         [13, 15, 30],
#         [11, 17, 31],
#         [16, 23, 39],
#         [20, 28, 49],
#         [32, 41, 70],
#         [49, 59, 94],
#         [74, 86, 126],
#         [59, 70, 115],
#         [45, 57, 99],
#         [35, 45, 81],
#         [27, 36, 65],
#         [20, 31, 49],
#         [17, 27, 37],
#         [18, 28, 37],
#         [19, 26, 42],
#         [21, 26, 45],
#         [22, 27, 46],
#         [22, 27, 46],
#     ],
#     [
#         [18, 16, 30],
#         [16, 15, 29],
#         [10, 12, 25],
#         [12, 16, 28],
#         [17, 23, 39],
#         [20, 28, 47],
#         [29, 39, 66],
#         [46, 56, 91],
#         [72, 84, 124],
#         [62, 75, 119],
#         [43, 56, 100],
#         [31, 43, 81],
#         [26, 40, 69],
#         [27, 39, 61],
#         [25, 39, 52],
#         [18, 31, 40],
#         [20, 29, 44],
#         [21, 28, 44],
#         [22, 29, 45],
#         [22, 29, 45],
#     ],
#     [
#         [17, 15, 29],
#         [14, 12, 26],
#         [10, 9, 23],
#         [12, 14, 27],
#         [16, 22, 38],
#         [18, 25, 44],
#         [25, 35, 62],
#         [42, 52, 87],
#         [67, 79, 121],
#         [72, 85, 130],
#         [60, 73, 118],
#         [45, 58, 100],
#         [32, 47, 80],
#         [25, 41, 66],
#         [27, 44, 60],
#         [21, 37, 50],
#         [22, 31, 46],
#         [23, 30, 46],
#         [24, 31, 47],
#         [25, 32, 48],
#     ],
#     [
#         [13, 10, 27],
#         [13, 11, 25],
#         [12, 11, 25],
#         [15, 17, 30],
#         [19, 22, 39],
#         [17, 22, 44],
#         [26, 33, 62],
#         [44, 52, 89],
#         [67, 78, 123],
#         [78, 90, 138],
#         [74, 86, 134],
#         [67, 82, 125],
#         [47, 63, 99],
#         [27, 44, 72],
#         [28, 46, 66],
#         [24, 41, 57],
#         [25, 37, 53],
#         [28, 35, 53],
#         [29, 36, 54],
#         [30, 37, 55],
#     ],
#     [
#         [12, 7, 27],
#         [14, 11, 28],
#         [17, 14, 31],
#         [21, 20, 36],
#         [21, 22, 42],
#         [19, 21, 46],
#         [28, 33, 65],
#         [49, 54, 94],
#         [65, 71, 119],
#         [74, 84, 135],
#         [73, 85, 137],
#         [78, 92, 139],
#         [61, 79, 119],
#         [33, 52, 84],
#         [31, 51, 76],
#         [28, 46, 66],
#         [30, 41, 59],
#         [34, 41, 59],
#         [34, 41, 59],
#         [35, 42, 60],
#     ],
#     [
#         [17, 9, 32],
#         [17, 12, 34],
#         [19, 14, 36],
#         [21, 18, 39],
#         [24, 22, 46],
#         [22, 22, 50],
#         [33, 33, 69],
#         [51, 54, 97],
#         [74, 77, 128],
#         [80, 85, 141],
#         [99, 108, 165],
#         [104, 116, 168],
#         [78, 92, 137],
#         [51, 69, 107],
#         [39, 60, 91],
#         [34, 52, 76],
#         [36, 47, 67],
#         [38, 45, 64],
#         [41, 48, 67],
#         [41, 48, 67],
#     ],
#     [
#         [25, 17, 41],
#         [24, 16, 40],
#         [22, 14, 37],
#         [22, 17, 40],
#         [26, 22, 47],
#         [26, 23, 54],
#         [35, 33, 72],
#         [53, 51, 98],
#         [76, 76, 130],
#         [80, 82, 139],
#         [102, 107, 165],
#         [128, 137, 192],
#         [105, 119, 168],
#         [68, 86, 126],
#         [40, 60, 93],
#         [42, 59, 85],
#         [43, 54, 76],
#         [45, 52, 71],
#         [48, 55, 74],
#         [50, 57, 76],
#     ],
#     [
#         [28, 18, 43],
#         [25, 15, 40],
#         [21, 11, 35],
#         [23, 15, 39],
#         [28, 19, 46],
#         [29, 22, 53],
#         [38, 32, 70],
#         [56, 50, 96],
#         [81, 76, 130],
#         [86, 85, 143],
#         [96, 98, 157],
#         [120, 127, 182],
#         [110, 122, 172],
#         [85, 100, 141],
#         [54, 73, 106],
#         [57, 74, 100],
#         [51, 62, 82],
#         [50, 59, 76],
#         [55, 64, 81],
#         [59, 68, 85],
#     ],
#     [
#         [31, 21, 46],
#         [31, 21, 45],
#         [29, 19, 43],
#         [32, 22, 46],
#         [37, 27, 52],
#         [39, 28, 58],
#         [49, 39, 76],
#         [66, 57, 102],
#         [86, 77, 130],
#         [101, 96, 154],
#         [103, 102, 160],
#         [95, 98, 153],
#         [105, 113, 160],
#         [99, 113, 152],
#         [80, 96, 129],
#         [64, 80, 105],
#         [66, 77, 95],
#         [62, 71, 86],
#         [66, 75, 90],
#         [73, 82, 97],
#     ],
#     [
#         [35, 23, 47],
#         [37, 25, 47],
#         [36, 24, 44],
#         [39, 27, 47],
#         [41, 29, 51],
#         [40, 27, 55],
#         [49, 35, 70],
#         [66, 53, 96],
#         [88, 76, 126],
#         [112, 103, 158],
#         [122, 119, 174],
#         [96, 98, 149],
#         [121, 128, 172],
#         [124, 134, 170],
#         [110, 125, 154],
#         [77, 92, 113],
#         [80, 92, 106],
#         [71, 81, 90],
#         [72, 82, 91],
#         [81, 91, 100],
#     ],
#     [
#         [44, 32, 52],
#         [45, 33, 53],
#         [44, 31, 49],
#         [46, 33, 51],
#         [48, 35, 55],
#         [45, 31, 56],
#         [53, 36, 68],
#         [68, 52, 91],
#         [89, 76, 122],
#         [109, 99, 149],
#         [127, 120, 172],
#         [110, 108, 157],
#         [134, 137, 178],
#         [137, 146, 179],
#         [130, 144, 170],
#         [99, 115, 131],
#         [70, 83, 91],
#         [58, 69, 73],
#         [57, 68, 72],
#         [67, 78, 82],
#     ],
#     [
#         [53, 40, 58],
#         [50, 37, 54],
#         [47, 33, 48],
#         [52, 38, 53],
#         [61, 47, 64],
#         [63, 48, 69],
#         [71, 52, 80],
#         [83, 66, 102],
#         [97, 82, 125],
#         [115, 103, 149],
#         [125, 117, 166],
#         [120, 117, 162],
#         [117, 119, 157],
#         [128, 135, 164],
#         [115, 127, 149],
#         [88, 102, 115],
#         [46, 60, 63],
#         [32, 44, 42],
#         [33, 45, 43],
#         [48, 60, 58],
#     ],
#     [
#         [36, 25, 39],
#         [30, 19, 33],
#         [25, 15, 26],
#         [36, 24, 36],
#         [53, 41, 53],
#         [61, 48, 65],
#         [69, 56, 76],
#         [81, 67, 93],
#         [104, 90, 123],
#         [131, 121, 156],
#         [134, 126, 163],
#         [132, 128, 161],
#         [98, 99, 127],
#         [113, 118, 140],
#         [82, 89, 107],
#         [46, 56, 65],
#         [35, 45, 46],
#         [20, 31, 27],
#         [25, 34, 31],
#         [43, 54, 50],
#     ],
#     [
#         [12, 9, 18],
#         [1, 0, 7],
#         [2, 0, 6],
#         [15, 10, 17],
#         [18, 13, 20],
#         [19, 13, 23],
#         [41, 35, 47],
#         [72, 66, 80],
#         [58, 54, 69],
#         [96, 92, 107],
#         [122, 119, 136],
#         [88, 86, 100],
#         [41, 40, 54],
#         [20, 20, 32],
#         [6, 9, 18],
#         [6, 9, 14],
#         [14, 18, 19],
#         [14, 19, 15],
#         [17, 19, 16],
#         [15, 20, 16],
#     ],
#     [
#         [0, 0, 5],
#         [0, 0, 5],
#         [0, 0, 5],
#         [0, 0, 5],
#         [0, 0, 5],
#         [0, 0, 5],
#         [5, 4, 10],
#         [15, 14, 20],
#         [0, 0, 5],
#         [2, 1, 7],
#         [14, 13, 19],
#         [8, 7, 13],
#         [5, 4, 10],
#         [7, 6, 12],
#         [0, 0, 5],
#         [0, 0, 4],
#         [0, 0, 0],
#         [0, 0, 0],
#         [0, 0, 0],
#         [0, 0, 0],
#     ],
#     [
#         [0, 0, 4],
#         [4, 3, 8],
#         [4, 3, 8],
#         [2, 1, 6],
#         [3, 2, 7],
#         [5, 4, 9],
#         [1, 0, 5],
#         [0, 0, 4],
#         [7, 6, 11],
#         [0, 0, 4],
#         [0, 0, 4],
#         [1, 0, 5],
#         [5, 4, 9],
#         [7, 6, 11],
#         [1, 0, 5],
#         [6, 6, 8],
#         [0, 0, 0],
#         [0, 0, 0],
#         [0, 0, 0],
#         [1, 1, 0],
#     ],
#     [
#         [0, 0, 4],
#         [3, 2, 7],
#         [2, 1, 6],
#         [0, 0, 4],
#         [2, 1, 6],
#         [7, 6, 11],
#         [6, 5, 10],
#         [0, 0, 4],
#         [2, 1, 6],
#         [0, 0, 4],
#         [2, 1, 6],
#         [1, 0, 5],
#         [0, 0, 4],
#         [0, 0, 4],
#         [0, 0, 4],
#         [1, 1, 3],
#         [2, 2, 2],
#         [2, 2, 0],
#         [2, 2, 0],
#         [2, 2, 0],
#     ],
# ]
# message = "Secret messages rock"
# inp = np.array(inp)

# inp1 = inp.copy()
# img1 = encode(inp1, message)
# inp2 = inp.copy()
# img2 = encode(inp2, "FAKE")
# inp3 = inp.copy()
# img3 = encode(inp3, "FAKE")


# messages = [img1.tolist(), img2.tolist(), img3.tolist()]

# # server
# msg1, msg2, msg3 = messages

# print(decode(np.array(msg1)))
# print(decode(np.array(msg2)))
# print(decode(np.array(msg3)))
